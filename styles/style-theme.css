/* --- styles/style-theme.css --- */

:root {
    --color-bg: #f4f4f4;
    --color-card-bg: rgba(255, 255, 255, 0.7);
    --color-mask-gradient: rgba(244, 244, 244, 0.4);
    --color-text: #111;
    --color-card-border: #bbb;
    --color-card-border-disabled: #ccc;
    --color-primary: #007bff;
    --color-primary-bg: rgba(0, 123, 255, 0.1);
    --color-danger: #dc3545;
    --color-danger-bg: rgba(220, 53, 69, 0.1);
    --color-success: #28a745;
    --color-success-bg: rgba(40, 167, 69, 0.1);
    --color-border-placeholder: #ddd; 
    --color-text-muted: #999;
    --color-header-bg: #222;
    --color-header-text: #fff;
    --color-footer-text: #888;
    --color-shadow-primary: rgba(0, 123, 255, 0.4);
    --color-shadow-disabled: rgba(150, 150, 150, 0.2);
    --color-shadow-modal: rgba(0, 0, 0, 0.5);
    --color-toast-bg: #222;
    --color-toast-text: #fff;
    --color-details-action-item-hover: rgba(255, 255, 255, 0.05);

    /* Color para el icono de Obras (Orange/Yellow en modo claro) */
    --color-icon-obras: #F89707; /* Orange/Yellow (Default/Claro) */

    /* 救넖잺 Control din치mico del filtro SVG */
    --shadow-color-hex: #969696; /* Color puro de la sombra Ghost (gris por defecto) */
    --shadow-opacity: 0.8;       /* Opacidad base de la sombra Ghost */

    /* 游늻 VARIABLES ESTRUCTURALES BASE */
    --header-height: 9dvh;
    --footer-height: 5dvh;
    --card-gap: 3dvh; 
    --nav-desktop-height: 100%; 
    --nav-carousel-top-offset: 2dvh;

    /* 游늻 VARIABLES DE FUENTE HEADER (Valores por defecto / Desktop) */
    /* T칤tulo: Crece con la letra pero frena si la pantalla es bajita */
    --header-title-size: clamp(0.8rem, calc((1rem + 2dvh) * var(--font-scale)), 3rem);
    
    /* LOGICA DE ICONOS: clamp(M칈NIMO_SEGURIDAD, AJUSTE_AL_HUECO_VERTICAL, PROPORCI칍N_TEXTO)
       - M칤nimo: P칤xeles fijos para que nunca desaparezca.
       - Ideal: % de la altura de pantalla (dvh) para que nunca desborde.
       - M치ximo: rem (que escala con el zoom) para que crezca junto al texto hasta topar con el techo.
    */
    --header-logo-size: clamp(24px, 8dvh, 4rem);
    --header-icon-size: clamp(24px, 8dvh, 3.7rem);
    --header-obras-size: clamp(16px, 6dvh, 3rem);

    --footer-font-size: clamp(0.5rem, calc((0.1rem + 2dvh) * var(--font-scale)), 1rem);

    /* 游늻 VARIABLES DE TARJETAS (CARDS) */
    --card-p-line-height: 1.4;
    --card-title-font-size: clamp(0.9rem, calc(1rem * var(--font-scale)), 1.3rem);
    --card-desc-font-size: clamp(0.8rem, calc(0.9rem * var(--font-scale)), 1.1rem);
    --card-h3-line-clamp: 3;
    --card-h3-icon: 1.4em;

    /* Nivel Actual */
    --card-nivel-actual-h3-line-clamp: 4;
    --card-nivel-actual-h3-line-height: 1.3;
    --card-nivel-actual-h3-font-size: clamp(0.9rem, calc(0.8rem * var(--font-scale)), 1.5rem);
    
    /* Breadcrumb Vertical */
    --card-breadcrump-h3-line-clamp: 4;
    --card-breadcrump-h3-line-height: 1.2;
    --card-breadcrump-vertical-font-size: 0.9rem;
    --card-breadcrump-vertical-h3-font-size: clamp(1rem, calc(0.9rem * var(--font-scale)), 1.4rem);
    --card-breadcrump-vertical-lice-clamp: 2;

    /* Bot칩n Volver Fijo */
    --card-volver-fija-h3-font-size: clamp(1rem, calc(0.8rem * var(--font-scale)), 3rem); 

    /* Info Adicional */
    --info-adicional-summary-font-size: clamp(0.9rem, calc(0.8rem * var(--font-scale)), 1.2rem); 
    --info-adicional-details-small-font-size: clamp(0.85rem, calc(0.75rem * var(--font-scale)), 1rem);
    --info-adicional-details-small-line-height: 1.5;
    --info-adicional-lista-a-font-size: clamp(0.9rem, calc(0.8rem * var(--font-scale)), 1.2rem);

    /* 游늻 VARIABLES DE TABLET LANDSCAPE */
    --tab-land-header-title-size: clamp(0.8rem, calc(5dvh * var(--font-scale)), 1.8rem);
    --tab-land-header-logo-size: clamp(24px, 7dvh, 3rem); 
    --tab-land-header-icon-size: clamp(24px, 7dvh, 2.7rem); 
    --tab-land-header-obras-size: clamp(16px, 5dvh, 2rem);

    /* 游늻 VARIABLES DE TABLET PORTRAIT */
    --tab-port-header-title-size: clamp(0.8rem, calc(4.5dvh * var(--font-scale)), 1.5rem);
    --tab-port-header-logo-size: clamp(24px, 6dvh, 2.8rem); 
    --tab-port-header-icon-size: clamp(24px, 6dvh, 2.5rem); 
    --tab-port-header-obras-size: clamp(16px, 4dvh, 1.8rem);

    /* 游늻 VARIABLES DE M칍VIL */
    --mobile-header-title-size: clamp(0.7rem, calc(2dvh * var(--font-scale)), 1rem);
    --mobile-header-logo-size: clamp(16px, 6dvh, 1.8rem) !important;
    --mobile-header-icon-size: clamp(16px, 6dvh, 1.6rem) !important;
    --mobile-header-obras-size: clamp(12px, 4dvh, 1.2rem) !important;

    --footer-social-link-size: clamp(12px, 2.5dvh, 1rem) !important;

    /* Tipograf칤a Din치mica */
    --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    --font-scale: 1;
    --line-height-base: 1.5;
    --paragraph-spacing: 1.5em;
    
    --font-dyslexic: 'OpenDyslexic', 'Comic Sans MS', sans-serif;
    --font-serif: 'Georgia', 'Times New Roman', serif;
    --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

    /* A11Y Modal */
    --a11y-title-font-size: clamp(1.1rem, calc((1rem + 1dvh) * var(--font-scale)), 1.8rem);
    --a11y-section-font-size: clamp(0.9rem, calc((0.8rem + 0.5dvh) * var(--font-scale)), 1.2rem);
    --a11y-close-btn-font-size: clamp(1.2rem, calc((1rem + 1dvh) * var(--font-scale)), 1.6rem);
    --a11y-close-btn-size: clamp(30px, calc(5dvh * var(--font-scale)), 50px);
    --a11y-option-btn-font-size: clamp(0.8rem, calc((0.75rem + 0.5dvh) * var(--font-scale)), 1rem);
    --a11y-slider-icon-size: clamp(0.8rem, calc(1rem * var(--font-scale)), 1.3rem);
    --a11y-range-value-font-size: clamp(0.8rem, calc((0.75rem + 0.5dvh) * var(--font-scale)), 1rem);

    /* 游늻 VISTA DE DETALLES */
    --details-text-fragment-font-size: clamp(0.8rem, calc(0.9rem * var(--font-scale)), 1rem);
    --details-text-fragment-line-height: 1.6;
    --details-title-slide-font-size: clamp(1rem, calc(1.1rem * var(--font-scale)), 1.1rem);

    --detail-vertical-spacing: calc(0.5rem * var(--line-height-base, 1.5));

    --details-action-btn-font-size: clamp(0.75rem, calc(0.9rem * var(--font-scale)), 1rem); 
    --details-action-btn-size: clamp(30px, calc(4dvh * var(--font-scale)), 45px);
    --details-action-icon-size: clamp(0.9rem, calc(1rem * var(--font-scale)), 1.1rem);
    --details-action-text-font-size: clamp(0.75rem, calc(0.9rem * var(--font-scale)), 1rem);
    --details-volver-btn-font-size: clamp(0.8rem, calc(1rem * var(--font-scale)), 1.1rem);
}

/* Aplicaci칩n de las variables al documento */
html {
    /* Esto escala todo el rem de la aplicaci칩n */
    font-size: calc(100% * var(--font-scale)); 
}

body {
    font-family: var(--font-family-base);
    line-height: var(--line-height-base);
}

p {
    margin-bottom: var(--paragraph-spacing);
}

@media (prefers-color-scheme: dark) {
    :root {   
        --color-bg: #111;
        --color-card-bg: rgba(255, 255, 255, 0.02);
        --color-mask-gradient: rgba(17, 17, 17, 0.4);
        --color-text: #eee;
        --color-card-border: #aaa; 
        --color-card-border-disabled: #666; 
        --color-border-placeholder: #555; 
        --color-header-bg: #222;
        --color-header-text: #fff;
        --color-footer-text: #888;
        --color-text-muted: #666;
        --color-shadow-primary: rgba(0, 123, 255, 0.4); 
        --color-shadow-disabled: rgba(170, 170, 170, 0.8);
        --color-shadow-modal: rgba(0, 0, 0, 0.7); 
        --color-toast-bg: #222;
        --color-toast-text: #fff;

        /* 救넖잺 CORRECCI칍N: Amarillo brillante para Obras en Modo Oscuro 救넖잺 */
        --color-icon-obras: #FFC107; /* Amarillo Brillante */

        /* 救넖잺 Variables a침adidas para el control din치mico del filtro SVG (Dark Mode) 救넖잺 */
        --shadow-color-hex: #888888;
    }
}

/* 救넖잺 Alto Contraste (prefers-contrast: more) 救넖잺 */
@media (prefers-contrast: more) {
    :root {
        /* Fondo y Contraste */
        --color-bg: #000000;
        --color-text: #FFFFFF;
        --color-card-bg: #000000; /* Fondo de tarjeta negro s칩lido */
        --color-mask-gradient: rgba(0, 0, 0, 0.9); /* M치scaras s칩lidas */
        
        /* Foco y 칄nfasis (Cian puro de alto contraste) */
        --color-primary: #00FFFF;
        --color-primary-bg: rgba(0, 255, 255, 0.1);
        --color-shadow-primary: transparent; /* Se elimina la sombra */
        
        /* Bordes y Deshabilitado */
        --color-card-border: #FFFFFF; /* Borde de tarjeta blanco */
        --color-card-border-disabled: #AAAAAA; /* Gris claro */
        --color-text-muted: #AAAAAA;
        
        /* Footer/Header */
        --color-header-bg: #000000;
        --color-footer-text: #FFFFFF;
        
        /* 救넖잺 Amarillo de alto contraste para Obras 救넖잺 */
        --color-icon-obras: #FFFF00; /* Amarillo Puro (Alto Contraste) */
        
        /* Eliminamos las sombras en las variables */
        --color-shadow-disabled: transparent;
    }
}

/* 救넖잺 Modo de Colores Forzados (High Contrast Mode) 救넖잺 */
@media (forced-colors: active) {
    
    /* === 1. TARJETAS (Cards) y BOT칍N VOLVER FIJO === */
    .card,
    #card-volver-fija-elemento {
        border: 2px dashed LinkText !important;
    }

    /* Foco en tarjeta habilitada -> Borde AZUL (Highlight) */
    .card:not(.disabled):not([data-tipo="relleno"]).focus-visible,
    .card:not(.disabled):not([data-tipo="relleno"]):focus-visible,
    .card:not(.disabled):not([data-tipo="relleno"]).focus-current,
    #card-volver-fija-elemento:focus-visible,
    #card-volver-fija-elemento.focus-visible,
    #card-volver-fija-elemento.focus-current {
        border: 4px solid Highlight !important; /* AZUL */
        outline: none !important;
    }

    /* Tarjeta Deshabilitada -> Borde GRIS (GrayText) */
    .card.disabled {
        border: 2px dashed LinkText !important;
        opacity: 1 !important; /* Opacidad 1 para ver bien el color */
        color: GrayText !important;
    }
    
    /* Foco en deshabilitada -> Borde BLANCO/TEXTO (CanvasText) */
    .card.disabled:focus-visible,
    .card.disabled.focus-visible {
        border: 4px solid GrayText !important; /* BLANCO */
    }

    /* Tarjetas de Relleno/Breadcrumb -> Borde DISCONTINUO */
    .card[data-tipo="relleno"],
    .card.card-breadcrumb-vertical {
        border: 2px dashed CanvasText !important;
        opacity: 0.6;
    }

    /* === 2. ICONOS (M츼SCARAS) === */
    /* Aqu칤 background-color define el color de la TINTA del icono, no del fondo */
    
    .icon-vacio-card, 
    .card-icon-lead, 
    .icon-obras-card,
    .icon-obras-header,
    .action-icon {
        forced-color-adjust: none;
        background-color: CanvasText !important; /* Tinta Normal */
    }

    /* Iconos Deshabilitados -> Tinta GRIS */
    .card.disabled .icon-vacio-card,
    .card.disabled .card-icon-lead,
    .detail-action-btn.disabled .action-icon {
        background-color: GrayText !important;
    }
    
    /* === 3. BOT칍N A11Y (El bot칩n es la m치scara) === */
    #btn-config-accesibilidad {
        forced-color-adjust: none;
        border: 2px solid ButtonText !important;
        background-color: LinkText !important; /* Tinta Normal */
    }
    #btn-config-accesibilidad:focus-visible {
        border-color: Highlight !important;
        background-color: Highlight !important; /* Tinta AZUL al foco */
    }

    /* === 4. ENLACES (Info, Footer) - SIN TOCAR FONDO === */
    #info-adicional summary, 
    #info-adicional a,
    footer a {
        color: LinkText !important;
        text-decoration: underline;
    }

    /* Foco -> Texto AZUL (Highlight) sin fondo */
    #info-adicional summary:focus, 
    #info-adicional a:focus,
    #info-adicional a:focus-visible,
    footer a:focus,
    footer a:focus-visible {
        color: Highlight !important; 
        outline: 2px dotted Highlight !important;
        background-color: transparent !important;
        text-decoration: none;
    }

    /* Iconos Footer */
    .footer-social-link::before {
        forced-color-adjust: none;
        background-color: LinkText !important; /* Tinta Amarilla/Enlace */
    }
    .footer-social-link:focus-visible::before,
    .footer-social-link:hover::before {
        background-color: Highlight !important; /* Tinta Azul */
    }

    /* === 5. VISTA DETALLE === */
    .detail-text-fragment {
        border-left: none !important;
    }

    .detail-text-fragment:focus-visible,
    .detail-text-fragment.focus-current {
        border-left: 6px solid Highlight !important; /* Barra lateral Azul */
        background-color: transparent !important;
    }

    .detail-action-btn {
        border: 2px solid LinkText !important;
    }
    .detail-action-btn:focus-visible {
        border: 4px solid Highlight !important;
    }
    /* Icono dentro del bot칩n de acci칩n */
    .detail-action-btn:focus-visible .action-icon {
        background-color: Highlight !important;
    }
}

/* ============================================================
   游뚿 REGLAS "HARD CAP" PARA SAFE MODE (Cumplimiento Reflow 508/WCAG) 游뚿
   Sobrescribimos las variables cr칤ticas con topes en PIXELES (px).
   Esto evita que la "Doble Multiplicaci칩n" (rem * scale) rompa el dise침o
   en pantallas peque침as (<320px) cuando el zoom es alto.
   ============================================================ */

body[data-safe-mode="true"] {
    /* --- VISTA DE DETALLES: Topes f칤sicos estrictos --- */
    
    --detail-vertical-spacing: 2px !important;

    /* T칤tulo: M치ximo 24px (1.5 l칤neas en 320px) */
    --details-title-slide-font-size: clamp(16px, 5dvh, 24px) !important;
    
    /* Texto cuerpo: M치ximo 18px (Lectura c칩moda sin desbordar) */
    --details-text-fragment-font-size: clamp(14px, 4dvh, 18px) !important;
    
    /* Botones de Acci칩n: Cr칤tico para que no ocupen todo el ancho */
    --details-action-btn-font-size: clamp(12px, 3dvh, 16px) !important; 
    --details-action-btn-size: clamp(30px, 8dvh, 44px) !important; /* Altura m치xima f칤sica */
    --details-action-icon-size: clamp(14px, 4dvh, 20px) !important;
    --details-action-text-font-size: clamp(12px, 3dvh, 16px) !important;
    
    /* Bot칩n Volver interno */
    --details-volver-btn-font-size: clamp(14px, 4dvh, 18px) !important;

    /* --- MENU M칍VIL: Topes f칤sicos --- */
    --mobile-header-title-size: clamp(14px, 3dvh, 20px) !important;
    --card-title-font-size: clamp(14px, 4dvh, 20px) !important;
    --card-desc-font-size: clamp(12px, 3dvh, 16px) !important;
    
    --card-breadcrump-vertical-h3-font-size: clamp(14px, 4dvh, 18px) !important;
    --card-nivel-actual-h3-font-size: clamp(14px, 4dvh, 20px) !important;
    --card-volver-fija-h3-font-size: clamp(16px, 5dvh, 24px) !important;

    /* Footer */
    --footer-font-size: clamp(10px, 2dvh, 14px) !important;
    --footer-social-link-size: clamp(16px, 4dvh, 24px) !important;
}

/* --- styles/style-theme.css --- */